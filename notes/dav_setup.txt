
                                DAV SETUP
                                =========
                                   or, 
   how Subversion developers can set up Apache/mod_dav/mod_dav_svn locally.


1.  Checkout the "httpd-2.0" cvs module from apache.org.  Put it
    whereever you wish;  it's an independent project.

      cvs -d :pserver:anoncvs@apache.org:/home/cvspublic login
         (password 'anoncvs')

      cvs -d :pserver:anoncvs@apache.org:/home/cvspublic co httpd-2.0

2.  cd httpd-2.0/srclib/, and checkout the "apr" and "apr-util"
    modules into this directory:

      cvs -d :pserver:anoncvs@apache.org:/home/cvspublic co apr
      cvs -d :pserver:anoncvs@apache.org:/home/cvspublic co apr-util

3.  At the top of the httpd-2.0 tree, run "buildconf".

4.  ./configure --enable-dav --enable-so --prefix=/usr/local/apache2 \
		--with-mpm=prefork

     The first arg says to build mod_dav.
     The second arg says to enable (and build everything) as shared libs.
     The third arg is where you will ultimately install apache.
     The fourth arg says to use the "prefork" style of operation.
       NOTE: The fourth arg is needed for FreeBSD systems (broken
       threads), but should be left out for other platforms (which
       will cause Apache to default to a threaded model of
       operation).  Also note that "libmm.so" is needed for the
       prefork option;  if you're running FreeBSD, you may have to
       build it out of /usr/ports.

     Note: if you build Subversion with --enable-maintainer-mode, then
     do the same for Apache. mod_dav_svn uses Apache's maintainer-mode
     stuff from its headers, so you want to ensure that Apache is
     built with the same assumption. Just add --enable-maintainer-mode
     to the configure line above.

     All instructions below assume you configured Apache to install
     under /usr/local/apache2/; substitute appropriately if you chose
     some other location.

5.  make && make clean && make depend && make install

6.  Go back into your subversion working copy and run ./autogen.sh if
    you need to.  Then run
 
      ./configure --with-apxs=/usr/local/apache2/bin/apxs

    This argument tells subversion to build mod_dav_svn, and where to
    find the required information to do so.

    Note: do *not* configure subversion with "--disable-shared"!
    mod_dav_svn *must* be built as a shared library.

    Note: it *is* possible to build mod_dav_svn as a static library
    and link it directly into Apache. Possible, but painful. Stick
    with the shared library for now; if you can't, then ask.

7. make clean && make && make install

   To be extra safe, you may want to `rm /usr/local/lib/libsvn*'
   before making Subversion, to avoid accidentally linking in any
   shared libraries leftover from a previous install of Subversion.

   After the make install, the Subversion shared libraries are in
   /usr/local/lib/.

8.  Add this to the *bottom* of /usr/local/apache2/conf/httpd.conf:

          <Location /svn/repos>
             DAV svn
             SVNPath /absolute/path/to/repository
          </Location>

    Make sure that the user 'nobody' (or whatever UID the httpd
    process runs as) is able to read the berkeley db files.

9.  Now fire up apache 2.0:

           /usr/local/apache2/bin/apachectl stop
           /usr/local/apache2/bin/apachectl start

    Check /usr/local/apache2/logs/error_log to make sure it started
    up okay.

10. Finally, try doing a network checkout from the repository:

          svn co http://localhost/svn/repos -d wc

    The most common reason this might fail is permission problems
    reading the repository.  If the checkout fails, chmod 777 and try
    again. :-)
