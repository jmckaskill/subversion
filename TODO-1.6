We are getting close to creating the 1.6.x branch.  This file lists the tasks
we want to complete before branching.  "Blocker" tasks must be done before we
branch, while "optional" tasks would be nice to have completed, but aren't
essential.

Tasks which need to happen before the 1.6.0 release, but aren't related to when
we branch should be put in the issue tracker with the 1.6 milestone.

Blocker:

 * Make SHA1 code in FSFS backend conditional on format version. [hwright]

 * Fix a bunch of rep-sharing issues in FSFS (or remove the feature):

   - svn_fs_fs__inc_rep_reuse (unlike svn_fs_fs__set_rep_reference) is
     used outside of the control of the FSFS lock.  Thus its
     read-modify-write can have race conditions, leading to two
     different rep key with the same reuse number.  Now, I'm not 100%
     sure how much of a problem this is; it would be good to document
     the point of the reuse number somewhere (unless I'm missing it).
     But I think it's to enable our dumb
     compare-if-a-node-has-changed-by-if-its-rep-key-has-changed thing
     to work, right?  And so there could be a subtle,
     difficult-to-diagnose problem if two reps end up with the same
     reuse number.  You could try to do this by wrapping the read and
     write inside a transaction (with retry loop), but I don't
     remember if SQLite transactions work that way.

     A potentially better solution: The point of the reuse column,
     AFAICT, is *not* to do a reference count.  It's just to uniquify
     references to the rep.  So switch it from a number to a string,
     and qualify the string by the name of the transaction that is
     creating the reference.  You can stick a counter for the current
     transaction in foo.txn/next-ids or something.  (Then you still
     might have to worry about concurrent writes to the same
     transaction, but of course that situation is full of problematic
     race conditions in FSFS anyway; fortunately all you have to avoid
     those is to avoid mod_dav_svn like the plague.)

   - 'structure' has not been updated.

 * Tree conflicts - essential issues:

   NOTE: If these tasks aren't fixed when 1.6 is branched,
   we should consider delaying tree conflicts entirely until 1.7.

   - #3328 "Update can't record >1 add/edit tree conflict per dir"
     http://subversion.tigris.org/issues/show_bug.cgi?id=3328

     A branch for this issue has been created:
     http://svn.collab.net/viewvc/svn/branches/update-tc-loggy/

     IRC conversation excerpts:
     <stsp> and do you know how important sbutler's branches/update-tc-loggy
            is for 1.6, and how long the branch may take?
     <stsp> the branch is about "loggy writing of tree conflicts during update",
            nothing has been committed to it yet
     <gstein> the conflicts must be written loggy
     <gstein> that came up last week
     <gstein> so the branch is required
     <neels> yea, sbutler is on that
     <gstein> yups

   - #3322: "In tree conflict info, report left/right URL@REV of the
             incoming change"
     http://subversion.tigris.org/issues/show_bug.cgi?id=3322

     Seriously needed improvement for resolving tree conflicts.

     [[[
     Note: This task is virtually done -- the required functionality
           has been implemented in branches/tc_url_rev/

            Missing bits on that branch:
            1) a few failing regression tests (should be trivial to fix)
            2) including URL@rev info in XML output (can also be done
               after the branch has been merged back to trunk)
     ]]]

     See also this thread:
     http://subversion.tigris.org/servlets/ReadMsg?list=dev&msgNo=145450

     IRC conversation excerpts:
     <stsp> but I don't want to release tc in 1.6 without issue
            #3322 fixed
     <stsp> I suppose following the example of git in this case is
            a good idea
     <stsp> when testing TCs with git, it was always relatively clear
            what I was supposed to do to resolve, and things just worked
     <stsp> mainly, having all relevant information, i.e. which files are
            involved at what revs, and easy access to those files was the key
     <stsp> I don't know whether this applies as cleanly to directories,
            we'll have to think about that (but maybe post-1.6 if we decide
            to limit 1.6 to files, which is an idea that has been around a
            long time)
     <julianfoad> Yes. That implies we make #3322 a priority, and do some
                  work on the messages (such as "Summary: 3 tree conflicts;
                  use svn info for details"), and do lots of walk-throughs
                  and documentation.
     <stsp> by having issue #3322 fixed, I mean
     <stsp> 1) having all required info stored in tc-info data
     <stsp> 2) having svn diff file@MINE/THEIRS etc. syntax (an optional,
            but really nice UI optimisation because then users won't have
            to copy-paste URLs all the time)
     <stsp> oh, and 1) implies not only storing the information, but also easy
            access to it for users, obviously :)
     <stsp> and I think we could also think about an alternative to 'svn info'
            as part of #3322


 * Other items

   - implement or back out svn_wc_queue_committed2()
   
   - back out svn_wc__adm_{save,get}_pristine_path, since gstein has
     found another way to access the necessary data. (leave the new
     shared state stuff in there, however)


Optional:

 * Merge the sparse-directories deselection branch, as noted by kfogel:
   http://svn.haxx.se/dev/archive-2008-10/1001.shtml

 * Tree conflicts - essential issues:

   - #3139, #3209: Tests XFAIL due to changed tree-conflicts behaviour

 * Tree conflicts - non-essential issues:

   - #3329: Update/switch fails if the target itself is a tree conflict victim.
     Should print a 'Skipped' message instead.  Update of an item that is
     inside a tree conflict, and that no longer exists in the repo, does
     nothing.  Should print a 'Skipped' message instead.

   - Making use of skels to store tree conflict data in entries file
     
     Mailing list thread:
     http://subversion.tigris.org/servlets/ReadMsg?listName=dev&msgNo=145582

     IRC conversation excerpts:
     <stsp> gstein, made up your mind about skels yet?
     <gstein> yeah. skels are all-ascii, so they'll work just fine in entries
     <gstein> two files to move to libsvn_subr
     <stsp> that was the only other tc-blocking issue I can remember
     <stsp> but the code as-is is working fine and has been tested for more
            than half a year
     <gstein> stsp: and the skel code works and has been tested for 8 years
     [...]
     <gstein> anyways, I do agree/believe that the code is solid,
     <stsp> well, I'm still not entirely convince the extra effort of changing
            the code to use skels is really worth it, but we'll see --
            I'd still say solve the other issues first, and convert to skels
            then if time is left
     <gstein> but it is more code to support over the long haul
     <gstein> the "read" code has to exist forever
     <stsp> yes
     <stsp> till 2.0
     <gstein> right
     <stsp> I don't mind maintaining the read code :)
     <gstein> I'd prefer that we don't have to carry it around
     <gstein> haha
     <gstein> well, the community has to maintain it
     <gstein> oh. what I was about to say, is that I'm leaving in 2 hrs,
     <gstein> but will work on skel'ing the code when I get home
     <stsp> right
     <gstein> I'll make the skels svn-private in trunk,
     <gstein> and then do the skel work on a branch for eval
     <stsp> that's fine -- I'm just objected to taking tc-focused resources
            away for skels from other things
     <stsp> if you do it, +1
     <gstein> well, I can more or less buy the "will only have to leave
              read code" argument,
     <gstein> so it is hard to strenuously object and maintain my -1,
     <gstein> so I'm good with doing the work myself
     <gstein> my wc work isn't going to be done for 1.6, so distraction
              is fine :-P
